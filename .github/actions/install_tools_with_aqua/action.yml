---
name: Install tools with aqua
description: Install tools with aqua

runs:
  using: composite
  # References
  # https://aquaproj.github.io/docs/products/aqua-installer#-caching
  steps:
    # This action does not automatically create a new cache if the job fails.
    # Job Results and Automatic Cache Creation
    # Successfully: Automatically create a cache
    # Failed:       Does not create cache
    # https://github.com/actions/cache/tree/v3.3.1#using-a-combination-of-restore-and-save-actions
    - name: Cache aqua
      uses: actions/cache@704facf57e6136b1bc63b828d79edcd491f0ee84 # v3.3.2
      with:
        path: ~/.local/share/aquaproj-aqua
        key: ${{ env.CACHE_PREFIX }}${{hashFiles('.aqua/**/*.yml')}}
        restore-keys: ${{ env.CACHE_PREFIX }}
      env:
        CACHE_PREFIX: v1-aqua-installer-${{ runner.os }}-${{ runner.arch }}-

    - name: Install tools with aqua
      # yamllint disable-line rule:line-length
      uses: aquaproj/aqua-installer@928a2ee4243a9ee8312d80dc8cbaca88fb602a91 # v2.2.0
      with:
        aqua_version: v2.21.0
        # Does not use `-l` or `--only-link` flags to cache all tools.
        aqua_opts: ""
      env:
        AQUA_LOG_LEVEL: debug
        AQUA_LOG_COLOR: always
